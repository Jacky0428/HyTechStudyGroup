# 5-1萬惡之源---重複（上）：從測試聞出code smell
## 用測試抓出重複  
與其複製貼上，不如直接重複呼叫，或是透過一些重構手法讓它適用在多種不同場景。  
最能減少重複懷味道的方法是密集度夠的單元測試。(程式有何缺陷，寫測試就感受的到)  
當寫測試發現在重複時，可能代表兩件事  
1. 介面設計不好，導致使用者一直做重複的事情。
2. 有很多類似的邏輯，在測試表現出來。

這時候便是重構的好時機了


## 程式重複迫使測試重複：舉個例子
![超長方法](images/5-1-1.png)
![超長方法](images/5-1-2.png)  
一段程式寫得好不好，看「形狀」就知道，如果第一次看不出來，當寫測試時會出現以下方法  
![超長方法](images/5-1-3.png)
![超長方法](images/5-1-4.png)
發現三個學生四個場景不停的重複，代表需要重構一下代碼了，接下來開始重構代碼。  


# 5-2萬惡之源---重複（下）：在測試的保護下重構
## 事前分析  
先看看原代碼邏輯  
![超長方法](images/5-2-1.png)
![超長方法](images/5-2-2.png)
![超長方法](images/5-2-3.png)
![超長方法](images/5-2-4.png)
![超長方法](images/5-2-5.png)  
整個calculate方法做了五件事:
1. 從成績單取得學生身份
2. 如果大學生，用大學生公式算獎學金
3. 如果碩士生，用碩士生公式算獎學金
4. 如果博士生，用博士生公式算獎學金
5. 如果都不是，拋錯誤  

一個方法只做一件事，方法太長會導致難以閱讀，先處理方法**太長**這件事
## 提取方法
![提取方法](images/5-3-1.png)
![提取方法](images/5-3-2.png)  
藉由提取三個方法(calculateBachelor、calculateMaster、calculatePhD)，大大的減少閱讀。
## 委託
處理一個方法只做一件事的問題。
![委託](images/5-4-1.png)
![委託](images/5-4-2.png)
## 抽取介面  

## 將程式改寫成符合高階抽象邏輯的寫法
## Reference
# 5-3可惡想要：Feature Envy
## Feature Envy(依戀情結)
## 解決之道
## 舉例
## Reference
# 5-4難兄難弟：Data Clump與Primitive Obsession
## Primitive Obsession(基本型别偏執)
## Data Clump(資料泥團)
## 難兄難弟
## 解決之道
## 舉例
## 出現了！其他壞味道
## Reference
# 5-5不殘而廢：Data Class
## 舉例
## 解決之道
## 「只有資料的物件」一定有Data Class壞味道嗎？
## 延伸思考題
## Reference
# 5.6一切皆空：Null
## 常見的Null發生場景
## 為什麽回傳Null是個壞味道？
## 解決之道
## 舉例
## Reference
# 5-7聽從你的蜥蜴腦：If
## if 為什麼是壞味道?
## 解決之道
## 舉例
## Reference
# 5-8在測試保護下重構出State設計模式
## 題目：Console Interaction
## 分析：隱藏的陷阱
## 開工：先用醜方法完成功能
## 暫停！聞聞壞味道
## 重構：決定策略再動手
## 第一步：把重複直接暴露出來
## 第二步：把同status的功能放在一起
## 第三步：以State類别取代status字串
## 驗收：確認重構後的可擴展性
## 結論
## Reference